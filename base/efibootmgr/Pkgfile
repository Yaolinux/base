description="Tool to modify UEFI Firmware Boot Manager Variables"
url="https://github.com/rhinstaller/efibootmgr"

packager="Grat-OS Team"

makedepends=(efivar pciutils dosfstools)
run=(dosfstools)

PKGMK_KEEP_SOURCES="no"

name=efibootmgr
version=17
_commit=edc8b9b6ec1c7751ccb9a483405c99141ba237fc
release=3

source=(https://github.com/rhboot/$name/archive/${_commit}.tar.gz)

x86_build() {
cd $name-${_commit}

sed -e '/extern int efi_set_verbose/d' -i "src/efibootmgr.c"

make libdir='/usr/lib' sbindir='/usr/bin' EFIDIR='/boot/efi'

make DESTDIR="${PKG}" \
     libdir='/usr/lib' \
     sbindir='/usr/bin' \
     EFIDIR='/boot/efi' \
     install
}

build() {

case $(uname -m) in
  x86_64|i686)
    x86_build
  ;;
  arm*|aarch64)
    echo "Nothing to do in Arm arch for the moment"
    mkdir -pv $PKG/usr
    cat > $PKGMK_ROOT/$name.post-install << EOF
source lib/lsb/init-functions
echo -e "\${FAILURE}Package $name is not available for ARM arch for the moment"
echo -e "Please remove the package as soon you have seen this message\${NORMAL}"
EOF
  ;;
esac
}
