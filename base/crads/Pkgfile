description="A set of utilities to manage software packages on Grat-OS distribution."
url="https://code.grat-os.fr/Grat-OS/crads"

makedepends=(curl kernel-headers libarchive zstd)

maintainer="Grat-OS Team"
packager="Grat-OS Team"

alias=(crad)

PKGMK_IGNORE_RUNTIMEDEPS="no"

run_devel=(acl.devel attr.devel autoconf automake binutils.devel bison \
bzip2.devel curl curl.devel dialog.devel e2fsprogs.devel expat.devel \
file.devel flex.devel gawk gawk.devel gcc.devel gdbm.devel gettext.devel \
glibc.devel gmp.devel gperf groff iproute2.devel kernel-headers kernel-headers.devel \
kmod.devel libarchive.devel libcap.devel libelf.devel libpipeline.devel libtool \
lvm2.devel lzo.devel m4 make meson mpc.devel mpfr.devel nasm ncurses.devel \
ninja openssl.devel pam.devel patch perl procps-ng.devel pkg-config python python.devel \
readline.devel rsync systemd.devel tar texinfo texinfo.devel util-linux.devel \ 
wget xz.devel zlib.devel zstd.devel)

PKGMK_GROUPS=(devel doc man)

name=crads
version=2.4.140
release=2

source=(https://repo.grat-os.fr/files/$name-$version.tar.gz)

build() {
  cd $name-$version

  CFLAGS+=' -std=c++14'

  make all
  make DESTDIR=$PKG install
  mkdir -p $PKG/{etc,usr}/ports
}

devel() {
  cd $PKG

  bsdtar -cf \
  $PKGMK_PACKAGE_DIR/$name.${group}${PKGMK_BUILDVER}${PKGMK_ARCH}.$PKGMK_PACKAGE_EXT \
  usr/bin usr/ports var/lib/pkg/drivers etc/ports etc/pkgmk.conf.example

  rm -rf var/lib/pkg/drivers usr/bin usr/ports etc/pkgmk.conf.example etc/ports 
}
